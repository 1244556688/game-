<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>蛇蛇大作戰</title>
<style>
  body { margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#222; color:#fff; font-family:sans-serif; touch-action:none;}
  canvas { background:#111; display:block; border:2px solid #fff; }
  #score { position:absolute; top:10px; left:10px; font-size:18px; }
</style>
</head>
<body>
<div id="score">分數: 0</div>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth*0.9;
canvas.height = window.innerHeight*0.7;

const grid = 20;
let snake = [{x:8*grid, y:8*grid}];
let food = {x: Math.floor(Math.random()*canvas.width/grid)*grid, y: Math.floor(Math.random()*canvas.height/grid)*grid};
let dx = grid;
let dy = 0;
let score = 0;

function drawSnake(){
  ctx.fillStyle = '#0f0';
  snake.forEach(segment=> ctx.fillRect(segment.x, segment.y, grid-2, grid-2));
}

function drawFood(){
  ctx.fillStyle = '#f00';
  ctx.fillRect(food.x, food.y, grid-2, grid-2);
}

function update(){
  const head = {x:snake[0].x+dx, y:snake[0].y+dy};

  // 撞牆或撞自己
  if(head.x<0 || head.x>=canvas.width || head.y<0 || head.y>=canvas.height || snake.some(s=>s.x===head.x && s.y===head.y)){
    alert('遊戲結束! 分數: '+score);
    document.location.reload();
  }

  snake.unshift(head);

  // 吃到食物
  if(head.x===food.x && head.y===food.y){
    score++;
    document.getElementById('score').innerText='分數: '+score;
    food = {x: Math.floor(Math.random()*canvas.width/grid)*grid, y: Math.floor(Math.random()*canvas.height/grid)*grid};
  }else{
    snake.pop();
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawFood();
  drawSnake();
  update();
  setTimeout(draw, 100);
}

// 觸控控制
let startX, startY;
canvas.addEventListener('touchstart', e=>{ startX=e.touches[0].clientX; startY=e.touches[0].clientY; });
canvas.addEventListener('touchend', e=>{
  let endX=e.changedTouches[0].clientX;
  let endY=e.changedTouches[0].clientY;
  let diffX=endX-startX;
  let diffY=endY-startY;
  if(Math.abs(diffX)>Math.abs(diffY)){
    if(diffX>0 && dx===0){ dx=grid; dy=0; }
    else if(diffX<0 && dx===0){ dx=-grid; dy=0; }
  }else{
    if(diffY>0 && dy===0){ dx=0; dy=grid; }
    else if(diffY<0 && dy===0){ dx=0; dy=-grid; }
  }
});

draw();
</script>
</body>
</html>
