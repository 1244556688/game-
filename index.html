<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>平板飛機射擊</title>
<style>
  body { margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#111; color:#fff; font-family:sans-serif; touch-action:none; }
  canvas { background:#222; display:block; border:2px solid #fff; }
  #scoreboard { position:absolute; top:10px; left:10px; font-size:18px; }
</style>
</head>
<body>
<div id="scoreboard">分數: 0</div>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth*0.9;
canvas.height = window.innerHeight*0.7;

let score = 0;

// 飛機
const plane = {
  width:50,
  height:50,
  x:canvas.width/2 - 25,
  y:canvas.height - 60,
  speed:7
};

// 子彈
let bullets = [];

// 敵人
let enemies = [];
const enemySpeed = 2;
const enemySpawnInterval = 1500;

function spawnEnemy(){
  const size = 40;
  const x = Math.random()*(canvas.width-size);
  enemies.push({x:x, y:-size, width:size, height:size});
}
setInterval(spawnEnemy, enemySpawnInterval);

// 繪製飛機
function drawPlane(){
  ctx.fillStyle = '#0f0';
  ctx.fillRect(plane.x, plane.y, plane.width, plane.height);
}

// 繪製子彈
function drawBullets(){
  ctx.fillStyle = '#ff0';
  bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
}

// 繪製敵人
function drawEnemies(){
  ctx.fillStyle = '#f00';
  enemies.forEach(e => ctx.fillRect(e.x, e.y, e.width, e.height));
}

// 更新遊戲
function update(){
  // 移動子彈
  bullets.forEach((b, i) => {
    b.y -= b.speed;
    if(b.y + b.height < 0) bullets.splice(i,1);
  });

  // 移動敵人
  enemies.forEach((e, i) => {
    e.y += enemySpeed;
    // 撞飛機
    if(e.x < plane.x + plane.width && e.x + e.width > plane.x &&
       e.y < plane.y + plane.height && e.y + e.height > plane.y){
         alert('遊戲結束! 分數:'+score);
         document.location.reload();
    }
    // 檢查子彈碰撞敵人
    bullets.forEach((b,j)=>{
      if(b.x < e.x + e.width && b.x + b.width > e.x &&
         b.y < e.y + e.height && b.y + b.height > e.y){
           enemies.splice(i,1);
           bullets.splice(j,1);
           score++;
           document.getElementById('scoreboard').innerText='分數: '+score;
      }
    });
    // 敵人掉到底部
    if(e.y > canvas.height) enemies.splice(i,1);
  });
}

// 畫面
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlane();
  drawBullets();
  drawEnemies();
  update();
  requestAnimationFrame(draw);
}
draw();

// 觸控控制飛機左右
let touchStartX = 0;
canvas.addEventListener('touchstart', e=>{ touchStartX=e.touches[0].clientX; });
canvas.addEventListener('touchmove', e=>{
  let touchX = e.touches[0].clientX;
  let diff = touchX - touchStartX;
  plane.x += diff;
  if(plane.x<0) plane.x=0;
  if(plane.x+plane.width>canvas.width) plane.x=canvas.width-plane.width;
  touchStartX = touchX;
});

// 點擊或觸控發射子彈
canvas.addEventListener('touchend', e=>{
  bullets.push({x:plane.x+plane.width/2-5, y:plane.y-10, width:10, height:20, speed:7});
});
canvas.addEventListener('click', e=>{
  bullets.push({x:plane.x+plane.width/2-5, y:plane.y-10, width:10, height:20, speed:7});
});
</script>
</body>
</html>
